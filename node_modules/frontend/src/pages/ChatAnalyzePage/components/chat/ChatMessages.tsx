import React, { useEffect, useRef } from 'react'
import type { Message } from '../../types/analyze.types'
import { Loader2Icon } from 'lucide-react'
interface ChatMessagesProps {
  messages: Message[]
  loading: boolean
}
export const ChatMessages: React.FC<ChatMessagesProps> = ({
  messages,
  loading,
}) => {
  const messagesEndRef = useRef<HTMLDivElement>(null)
  const scrollToBottom = () => {
    messagesEndRef.current?.scrollIntoView({
      behavior: 'smooth',
    })
  }
  useEffect(() => {
    scrollToBottom()
  }, [messages])
  return (
    <div className="flex-1 overflow-y-auto p-4 space-y-4">
      {messages.length === 0 ? (
        <div className="flex items-center justify-center h-full">
          <div className="text-center text-gray-500">
            <p className="mb-2">Xin chào! Tôi là trợ lý GreenGrow.</p>
            <p>Bạn cần hỗ trợ gì hôm nay?</p>
          </div>
        </div>
      ) : (
        messages.map((message, index) => (
          <div
            key={index}
            className={`flex ${message.role === 'user' ? 'justify-end' : 'justify-start'}`}
          >
            <div
              className={`max-w-[80%] rounded-2xl p-4 ${message.role === 'user' ? 'bg-green-600 text-white' : 'bg-gray-100 text-gray-800'}`}
            >
              {message.type === 'text' && <p>{message.content}</p>}
              {message.type === 'image' && (
                <div className="relative">
                  <img
                    src={message.content}
                    alt="Uploaded plant"
                    className="rounded-lg max-w-full"
                    style={{
                      maxHeight: '200px',
                    }}
                  />
                </div>
              )}
            </div>
          </div>
        ))
      )}
      {loading && (
        <div className="flex justify-start">
          <div className="max-w-[80%] rounded-2xl p-4 bg-gray-100 text-gray-800 flex items-center gap-2">
            <Loader2Icon className="animate-spin" size={16} />
            <p>Đang phân tích...</p>
          </div>
        </div>
      )}
      <div ref={messagesEndRef} />
    </div>
  )
}
