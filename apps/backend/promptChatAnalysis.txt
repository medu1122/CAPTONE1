# Core Behaviors
## 1. Case 1 â€“ Text-only message
- Khi ngÆ°á»i dÃ¹ng chá»‰ nháº­p text (vÃ­ dá»¥: â€œCÃ¡ch trá»“ng cÃ¢y lan trong mÃ¹a mÆ°a?â€):
  - Gá»i GPT API Ä‘á»ƒ sinh pháº£n há»“i.
  - KÃ¨m dá»¯ liá»‡u thá»i tiáº¿t hiá»‡n táº¡i (tá»« OpenWeather API).
  - GPT tráº£ lá»i tá»± nhiÃªn vÃ  tÆ° váº¥n phÃ¹ há»£p.
  - Gá»£i Ã½ thÃªm sáº£n pháº©m náº¿u cáº§n (fetch tá»« product_recommendations hoáº·c link Shopee).

## 2. Case 2 â€“ Image + text (hoáº·c chá»‰ áº£nh)
- Khi ngÆ°á»i dÃ¹ng gá»­i áº£nh:
  - Upload áº£nh â†’ gá»i Plant.id API â†’ nháº­n káº¿t quáº£ cÃ¢y & bá»‡nh.
  - GPT táº¡o pháº£n há»“i â€œÄÃ¢y lÃ  phÃ¢n tÃ­ch cá»§a GreenGrowâ€¦â€ + diá»…n giáº£i káº¿t quáº£.
  - Hiá»ƒn thá»‹ thÃ´ng tin qua 3 card bÃªn pháº£i:
    - OverviewCard: tÃ³m táº¯t tÃªn cÃ¢y, bá»‡nh, cÃ¡ch chÄƒm sÃ³c.
    - ImageAnalysisCard: hiá»ƒn thá»‹ áº£nh + bounding box (náº¿u cÃ³).
    - ProductListCard: hiá»ƒn thá»‹ gá»£i Ã½ sáº£n pháº©m phÃ¹ há»£p.

- Náº¿u cÃ¢u há»i quÃ¡ dÃ i hoáº·c mÆ¡ há»“:
  - GPT xÃ¡c Ä‘á»‹nh xem cÃ³ cáº§n gá»i Plant.id hay chá»‰ tráº£ lá»i text.
  - Tráº£ lá»i tÆ°Æ¡ng á»©ng.

## 3. Case 3 â€“ Invalid / spam input
- Náº¿u Plant.id tráº£ Ä‘á»™ tin cáº­y tháº¥p hoáº·c GPT phÃ¡t hiá»‡n cÃ¢u há»i khÃ´ng liÃªn quan:
  - Bot tráº£ lá»i â€œáº¢nh khÃ´ng há»£p lá»‡â€ hoáº·c â€œCÃ¢u há»i khÃ´ng thuá»™c lÄ©nh vá»±c nÃ´ng nghiá»‡pâ€.
  - KhÃ´ng hiá»ƒn thá»‹ tháº» phÃ¢n tÃ­ch.

---

# Weather Context
- Hiá»ƒn thá»‹ widget thá»i tiáº¿t (trÃªn header ChatAnalyzePage).
- DÃ¹ng OpenWeather API `/weather` vÃ  `/forecast` Ä‘á»ƒ láº¥y:
  - Nhiá»‡t Ä‘á»™, Ä‘á»™ áº©m, tráº¡ng thÃ¡i trá»i hiá»‡n táº¡i.
  - Dá»± bÃ¡o 3â€“5 ngÃ y tá»›i.
- Cho phÃ©p:
  - Láº¥y vá»‹ trÃ­ tá»± Ä‘á»™ng báº±ng `navigator.geolocation`.
  - Hoáº·c cho ngÆ°á»i dÃ¹ng chá»n tá»‰nh/thÃ nh thá»§ cÃ´ng.

---

# Additional Scenarios
- Há»— trá»£ há»™i thoáº¡i liÃªn tá»¥c (GPT nhá»› ngá»¯ cáº£nh trong cÃ¹ng session).
- Náº¿u ngÆ°á»i dÃ¹ng há»i mÆ¡ há»“ â†’ bot yÃªu cáº§u gá»­i áº£nh.
- Náº¿u gá»­i áº£nh trÃ¹ng â†’ kiá»ƒm tra duplicate, trÃ¡nh gá»i API tá»‘n phÃ­.
- Náº¿u nhiá»u cÃ¢y trong áº£nh â†’ bot pháº£n há»“i yÃªu cáº§u chá»n cÃ¢y cá»¥ thá»ƒ.
- Há»— trá»£ guest session (khÃ´ng login váº«n dÃ¹ng táº¡m).
- Hiá»ƒn thá»‹ loading state khi AI Ä‘ang phÃ¢n tÃ­ch.


cáº§n bá»• sung
weather/
â”œâ”€â”€ weather.controller.js    # Xá»­ lÃ½ request tá»« frontend (/api/v1/weather)
â”œâ”€â”€ weather.service.js       # Gá»i OpenWeather API
â”œâ”€â”€ weather.routes.js        # Äá»‹nh nghÄ©a route
â””â”€â”€ weather.validation.js    # XÃ¡c thá»±c query (cityName, lat/lon)
productRecommendations/ module

ğŸ‘‰ Ä‘á»ƒ backend quáº£n lÃ½ & tráº£ danh sÃ¡ch gá»£i Ã½ sáº£n pháº©m cho GPT / Chat UI.

ğŸ“ Cáº¥u trÃºc:

productRecommendations/
â”œâ”€â”€ productRecommendation.controller.js
â”œâ”€â”€ productRecommendation.model.js
â”œâ”€â”€ productRecommendation.routes.js
â””â”€â”€ productRecommendation.service.js


ğŸ“¡ Endpoint:

GET /api/v1/products/recommendations?plant=tomato&disease=leafspot
Dá»¯ liá»‡u sáº½ hiá»ƒn thá»‹ á»Ÿ ProductListCard.tsx.

CÃ³ thá»ƒ thÃªm trÆ°á»ng externalLink (Shopee / Tiki / Lazada).
NÃŠN CÃ“ (Äá»‚ Tá»I Æ¯U Há»† THá»NG)
ğŸ§  aiAssistant/ module

ğŸ‘‰ trung gian giá»¯a GPT API vÃ  cÃ¡c module khÃ¡c (chat, analyze, weather, product).
Thay vÃ¬ gá»i GPT trá»±c tiáº¿p trong chat.service.js, táº¡o service riÃªng Ä‘á»ƒ dá»… má»Ÿ rá»™ng logic AI.

ğŸ“ Cáº¥u trÃºc:

aiAssistant/
â”œâ”€â”€ ai.controller.js
â”œâ”€â”€ ai.service.js       # Gá»i GPT API, thÃªm context (thá»i tiáº¿t, phÃ¢n tÃ­ch hÃ¬nh, v.v.)
â”œâ”€â”€ ai.routes.js
â””â”€â”€ ai.validation.js


ğŸ“¡ Endpoint:

POST /api/v1/ai/respond


ğŸ“‹ Lá»£i Ã­ch:

Giá»¯ code sáº¡ch, dá»… test.

CÃ³ thá»ƒ log toÃ n bá»™ GPT input/output (Ä‘á»ƒ debug vÃ  training sau nÃ y).

ğŸ§© moderation/ middleware

ğŸ‘‰ Ä‘á»ƒ lá»c cÃ¡c ná»™i dung khÃ´ng há»£p lá»‡, spam, hoáº·c áº£nh khÃ´ng pháº£i cÃ¢y.

ğŸ“ Cáº¥u trÃºc:

common/middleware/moderation.js


ğŸ“‹ Gá»£i Ã½ logic:

Vá»›i text â†’ kiá»ƒm tra keyword cÃ³ liÃªn quan Ä‘áº¿n nÃ´ng nghiá»‡p khÃ´ng.

Vá»›i áº£nh â†’ náº¿u file khÃ´ng pháº£i .jpg, .png, hoáº·c kÃ­ch thÆ°á»›c < 100KB â†’ tá»« chá»‘i.

CÃ³ thá»ƒ tÃ­ch há»£p thÃªm OpenAI Moderation API (sau nÃ y).